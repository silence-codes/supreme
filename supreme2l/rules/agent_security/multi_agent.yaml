# Supreme 2 Light Agent Security Rules - Multi-Agent Attack Patterns
# Source: Agent Security V2 (84 papers), RAG Security Research 2025
# Version: 1.0.0
# Last Updated: 2025-12-29

rules:
  # =============================================================================
  # CASCADE AND PROPAGATION ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-CASCADE-001
    name: agent-smith-attack
    severity: CRITICAL
    category: cascade_attack
    patterns:
      - '(?i)Agent\s*Smith'
      - '(?i)exponential\s+infection'
      - '(?i)inter[-_]?agent\s+(?:messaging|infection)'
      - '(?i)(?:jailbreak|infect)\s+(?:all|every|multiple)\s+agents?'
    message: "Agent Smith cascade attack pattern detected"
    description: |
      Agent Smith attack enables exponential infection across multi-agent systems
      via a single malicious input. Exploits unrestricted inter-agent messaging
      to rapidly jailbreak massive numbers of agents.
    owasp_llm: "LLM06:2025"
    mitre_atlas: "AML.T0048"
    cwe: "CWE-506"
    source_paper: "Agent Smith Attack (2024)"

  - id: SUPREME2L-MULTI-CASCADE-002
    name: flooding-knowledge-spread
    severity: HIGH
    category: cascade_attack
    patterns:
      - '(?i)flooding\s+spread'
      - '(?i)manipulated\s+knowledge'
      - '(?i)DPO.*bias|ROME.*FFN'
      - '(?i)counterfactual.*injection'
    message: "Flooding knowledge spread attack detected"
    description: |
      Two-stage attack using DPO for persuasiveness injection and ROME
      for knowledge injection. Modifies agent fact perception, achieves
      42% success on counterfactual knowledge after 3 turns.
    owasp_llm: "LLM04:2025"
    cwe: "CWE-506"
    attack_success_rate: 0.42

  - id: SUPREME2L-MULTI-CASCADE-003
    name: cascade-amplification
    severity: HIGH
    category: cascade_attack
    patterns:
      - '(?i)cascade\s+attack'
      - '(?i)multi[-_]?stage\s+exploit'
      - '(?i)(?:system|agent)\s+boundary\s+(?:cross|travers)'
      - '(?i)(?:implicit|blind)\s+trust\s+(?:between|among)\s+agents?'
    message: "Cascade amplification attack pattern detected"
    description: |
      Multi-stage exploits that traverse system boundaries, exploiting
      implicit trust between agents. ASR increases from 56% to 70% in
      composed attacks.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"

  # =============================================================================
  # PROMPT INFECTION (SELF-REPLICATING)
  # =============================================================================

  - id: SUPREME2L-MULTI-INFECT-001
    name: prompt-infection
    severity: CRITICAL
    category: self_replicating
    patterns:
      - '(?i)prompt\s+infection'
      - '(?i)LLM[-_]?to[-_]?LLM\s+(?:injection|attack)'
      - '(?i)self[-_]?replicat.*prompt'
      - '(?i)include\s+(?:this\s+)?attack\s+in\s+(?:next|following)\s+(?:agent|input)'
    message: "Self-replicating prompt infection detected"
    description: |
      Prompt infection includes self-replication instructions that spread
      the attack to subsequent agents. Components: prompt hijacking, payload,
      data collection, self-replication. 90% success rate on GPT-4o.
    owasp_llm: "LLM01:2025"
    mitre_atlas: "AML.T0051"
    cwe: "CWE-506"
    attack_success_rate: 0.90
    source_paper: "Prompt Infection (Lee, 2024)"

  - id: SUPREME2L-MULTI-INFECT-002
    name: infection-delimiters
    severity: HIGH
    category: self_replicating
    patterns:
      - '(?i)<<<\s*.*\s*>>>'
      - '(?i)\[\[\[\s*.*\s*\]\]\]'
      - '(?i)<\s*infection\s*>.*<\s*/\s*infection\s*>'
    message: "Prompt infection delimiter pattern detected"
    description: |
      Special delimiters used in prompt infection attacks to mark
      payload boundaries for self-replication.
    owasp_llm: "LLM01:2025"
    cwe: "CWE-506"

  # =============================================================================
  # TOPOLOGY-AWARE ATTACKS (TOMA)
  # =============================================================================

  - id: SUPREME2L-MULTI-TOPO-001
    name: topology-aware-attack
    severity: CRITICAL
    category: graph_attack
    patterns:
      - '(?i)TOMA\s+attack'
      - '(?i)topology[-_]?aware\s+(?:attack|exploit)'
      - '(?i)ACPM'
      - '(?i)Adversarial\s+Contamination\s+Propagation'
    message: "TOMA (Topology-aware) attack pattern detected"
    description: |
      TOMA exploits graph structure of multi-agent systems using
      Adversarial Contamination Propagation Model (ACPM). Uses
      hierarchical payload encapsulation. 40-78% success rate.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"
    attack_success_rate: 0.78
    source_paper: "TOMA (Liang, 2025)"

  - id: SUPREME2L-MULTI-TOPO-002
    name: sys-override-payload
    severity: CRITICAL
    category: graph_attack
    patterns:
      - '(?i)//[-_]*SYS[-_]*OVERRIDE[-_]*//'
      - '(?i)directive_id.*action.*reroute'
      - '(?i)hierarchical\s+payload\s+encapsulation'
    message: "TOMA SYS_OVERRIDE payload detected"
    description: |
      Specific payload pattern used in topology-aware attacks.
    owasp_llm: "LLM01:2025"
    cwe: "CWE-506"

  # =============================================================================
  # MEMORY AND STATE ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-MEM-001
    name: mextra-memory-injection
    severity: HIGH
    category: memory_attack
    patterns:
      - '(?i)MEXTRA'
      - '(?i)memory\s+(?:injection|poison)'
      - '(?i)(?:insert|inject)\s+malicious\s+(?:record|memory)'
      - '(?i)self[-_]?reinforcing\s+error'
    message: "MEXTRA memory injection attack detected"
    description: |
      MEXTRA inserts malicious records into agent RAG/memory databases,
      creating self-reinforcing error cycles. 100% ASR on EHRAgent.
    owasp_llm: "LLM04:2025"
    cwe: "CWE-506"
    attack_success_rate: 1.0
    source_paper: "MEXTRA (2025)"

  - id: SUPREME2L-MULTI-MEM-002
    name: privacy-memory-leak
    severity: HIGH
    category: memory_attack
    patterns:
      - '(?i)privacy\s+(?:risk|leak).*memory'
      - '(?i)memory\s+(?:exfiltrat|extract)'
      - '(?i)long[-_]?term\s+memory\s+(?:attack|exploit)'
    message: "Agent memory privacy leak pattern detected"
    description: |
      Attacks targeting agent long-term memory to exfiltrate private
      information stored across sessions.
    owasp_llm: "LLM02:2025"
    cwe: "CWE-200"

  # =============================================================================
  # MULTI-AGENT BACKDOORS
  # =============================================================================

  - id: SUPREME2L-MULTI-BACK-001
    name: collaborative-shadows
    severity: CRITICAL
    category: distributed_backdoor
    patterns:
      - '(?i)Collaborative\s+Shadows'
      - '(?i)distributed\s+backdoor'
      - '(?i)decomposed\s+backdoor'
      - '(?i)conditional\s+primitive.*payload\s+primitive'
    message: "Collaborative Shadows distributed backdoor detected"
    description: |
      Backdoor decomposed across multiple agents/tools. Only activates
      when agents collaborate in specific sequence. Uses steganographic
      headers and AES encryption. >95% success rate.
    owasp_llm: "LLM04:2025"
    cwe: "CWE-506"
    attack_success_rate: 0.95
    source_paper: "Collaborative Shadows (Zhu, 2025)"

  - id: SUPREME2L-MULTI-BACK-002
    name: observation-trigger-backdoor
    severity: HIGH
    category: agent_backdoor
    patterns:
      - '(?i)(?:observation|thought)[-_]?(?:attack|trigger)'
      - '(?i)environmental\s+feedback\s+trigger'
      - '(?i)intermediate\s+reasoning\s+(?:malicious|attack)'
    message: "Agent observation/thought backdoor trigger detected"
    description: |
      Agent backdoors triggered by environmental observations or
      intermediate reasoning steps, not just user queries.
    owasp_llm: "LLM04:2025"
    cwe: "CWE-506"
    source_paper: "Watch Out for Your Agents (Yang, 2024)"

  # =============================================================================
  # ROLE AND IDENTITY ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-ROLE-001
    name: doppelganger-attack
    severity: HIGH
    category: identity_attack
    patterns:
      - '(?i)Doppelganger\s+(?:method|attack)'
      - '(?i)(?:break|violate)\s+role\s+consistency'
      - '(?i)role\s+(?:confusion|hijack)'
    message: "Doppelganger role consistency attack detected"
    description: |
      Attack that breaks role consistency in multi-agent systems,
      causing agents to assume incorrect identities.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"
    source_paper: "Doppelganger Method (Kang, 2025)"

  - id: SUPREME2L-MULTI-ROLE-002
    name: identity-spoofing
    severity: HIGH
    category: identity_attack
    patterns:
      - '(?i)identity\s+(?:spoof|inherit|transition)'
      - '(?i)(?:impersonat|masquerad).*agent'
      - '(?i)(?:pretend|claim)\s+(?:to\s+be|you\s+are)\s+(?:another\s+)?agent'
    message: "Agent identity spoofing pattern detected"
    description: |
      Attacks that allow one agent to impersonate another, bypassing
      access controls and trust boundaries.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-290"

  # =============================================================================
  # REASONING PATH ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-REASON-001
    name: reasoning-hijack
    severity: HIGH
    category: reasoning_attack
    patterns:
      - '(?i)reasoning\s+(?:path\s+)?hijack'
      - '(?i)(?:decision|thought)\s+(?:path\s+)?manipulation'
      - '(?i)(?:chain[-_]?of[-_]?thought|CoT)\s+(?:attack|manipulat)'
    message: "Agent reasoning path hijack detected"
    description: |
      Attacks that manipulate the agent's reasoning chain to produce
      unintended actions or conclusions.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"

  - id: SUPREME2L-MULTI-REASON-002
    name: objective-drift
    severity: MEDIUM
    category: reasoning_attack
    patterns:
      - '(?i)objective\s+(?:function\s+)?drift'
      - '(?i)goal\s+(?:manipulation|substitution)'
      - '(?i)(?:redirect|change)\s+(?:agent\s+)?objective'
    message: "Agent objective drift attack detected"
    description: |
      Attacks that gradually shift the agent's objectives away from
      its intended purpose.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"

  # =============================================================================
  # COMMUNICATION MANIPULATION
  # =============================================================================

  - id: SUPREME2L-MULTI-COMM-001
    name: communication-manipulation
    severity: HIGH
    category: communication_attack
    patterns:
      - '(?i)(?:communication|message)\s+manipulat'
      - '(?i)inter[-_]?agent\s+(?:message\s+)?(?:tamper|inject)'
      - '(?i)(?:MITM|man[-_]?in[-_]?the[-_]?middle).*agent'
    message: "Inter-agent communication manipulation detected"
    description: |
      Attacks that intercept and modify messages between agents.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-924"

  - id: SUPREME2L-MULTI-COMM-002
    name: oversight-saturation
    severity: MEDIUM
    category: communication_attack
    patterns:
      - '(?i)oversight\s+saturat'
      - '(?i)(?:flood|overwhelm)\s+(?:monitor|oversight)'
      - '(?i)(?:noise|spam)\s+(?:attack|injection).*agent'
    message: "Oversight saturation attack detected"
    description: |
      Attacks that overwhelm monitoring systems with noise to hide
      malicious actions.
    owasp_llm: "LLM10:2025"
    cwe: "CWE-400"

  # =============================================================================
  # TRUST AND DELEGATION ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-TRUST-001
    name: blind-trust-exploitation
    severity: HIGH
    category: trust_attack
    patterns:
      - '(?i)(?:blind|implicit)\s+trust\s+(?:exploit|attack)'
      - '(?i)(?:unauthorized|unauthenticated)\s+(?:action\s+)?chain'
      - '(?i)trust\s+(?:boundary|chain)\s+(?:violat|bypass)'
    message: "Blind trust exploitation detected"
    description: |
      Exploits implicit trust relationships between agents to perform
      unauthorized actions.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-284"

  - id: SUPREME2L-MULTI-TRUST-002
    name: ip-leakage-attack
    severity: HIGH
    category: trust_attack
    patterns:
      - '(?i)IP\s+leakage\s+attack'
      - '(?i)intellectual\s+property\s+(?:leak|exfiltrat)'
      - '(?i)(?:proprietary|confidential)\s+(?:data|info).*multi[-_]?agent'
    message: "Multi-agent IP leakage attack detected"
    description: |
      Attacks designed to leak intellectual property through multi-agent
      system interactions.
    owasp_llm: "LLM02:2025"
    cwe: "CWE-200"
    source_paper: "IP Leakage Attacks on MAS (Wang, 2025)"

  # =============================================================================
  # STRUCTURED MULTI-AGENT ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-STRUCT-001
    name: multi-agent-debate-attack
    severity: HIGH
    category: structured_attack
    patterns:
      - '(?i)(?:multi[-_]?agent\s+)?debate\s+(?:attack|jailbreak)'
      - '(?i)structured\s+jailbreak.*debate'
      - '(?i)(?:corrupt|manipulat).*(?:debate|deliberat)'
    message: "Multi-agent debate attack detected"
    description: |
      Attacks targeting multi-agent debate systems to inject malicious
      consensus or bypass safety measures.
    owasp_llm: "LLM01:2025"
    cwe: "CWE-506"
    source_paper: "Structured Jailbreak Attacks on MAD (Qi, 2025)"

  - id: SUPREME2L-MULTI-STRUCT-002
    name: intention-hiding-agent
    severity: HIGH
    category: structured_attack
    patterns:
      - '(?i)intention[-_]?hiding\s+(?:agent|attack)'
      - '(?i)malicious\s+(?:agent\s+)?(?:disguise|camouflage)'
      - '(?i)attacker[-_]?disguiser\s+game'
    message: "Intention-hiding malicious agent pattern detected"
    description: |
      Agents designed to hide malicious intentions while appearing benign.
    owasp_llm: "LLM06:2025"
    cwe: "CWE-506"
    source_paper: "Learn to Disguise (Xu, 2024)"

  # =============================================================================
  # WEB AND EXTERNAL ATTACKS
  # =============================================================================

  - id: SUPREME2L-MULTI-WEB-001
    name: web-fraud-attack
    severity: HIGH
    category: external_attack
    patterns:
      - '(?i)web\s+fraud\s+attack.*(?:agent|MAS)'
      - '(?i)(?:phishing|scam).*multi[-_]?agent'
      - '(?i)(?:malicious|fake)\s+(?:website|URL).*agent'
    message: "Web fraud attack on multi-agent system detected"
    description: |
      Attacks using fraudulent web content to manipulate multi-agent systems.
    owasp_llm: "LLM01:2025"
    cwe: "CWE-601"
    source_paper: "Web Fraud Attacks Against MAS (Kong, 2025)"

  - id: SUPREME2L-MULTI-WEB-002
    name: fine-print-injection
    severity: MEDIUM
    category: external_attack
    patterns:
      - '(?i)fine[-_]?print\s+injection'
      - '(?i)GUI\s+(?:agent\s+)?(?:attack|exploit)'
      - '(?i)(?:hidden|small)\s+text.*(?:GUI|screen)'
    message: "Fine-print injection attack on GUI agent detected"
    description: |
      Injection attacks using small or hidden text in GUIs to manipulate
      visual-language agents.
    owasp_llm: "LLM01:2025"
    cwe: "CWE-94"
    source_paper: "Fine-Print Injections in GUI Agents (Chen, 2025)"
